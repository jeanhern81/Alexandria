<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0" />
	<link rel="icon" type="image/png" href="../images/Alexandria-symbol.png" />
	<!-- Compiled and minified CSS -->
	<link rel="stylesheet" href="../css/materialize.css" />
	<link rel="stylesheet" href="../css/mainsStyles.css" />
	<link rel="stylesheet" href="../css/properties.css" />
	<script src="../js/materialize.js"></script>

	<!--Google Fonts-->
	<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet" />
	<!--Font Awesome-->
	<script src="https://kit.fontawesome.com/8b8f26d0e1.js" crossorigin="anonymous"></script>
	<!-- Jquery -->
	<script src="https://code.jquery.com/jquery-3.5.1.js"
		integrity="sha256-QWo7LDvxbWT2tbbQ97B53yJnYU3WhH/C8ycbRAkjPDc=" crossorigin="anonymous"></script>
	<style>
		/* Set the size of the div element that contains the map */
		#map {
			height: 400px;
			/* The height is 400 pixels */
			width: 100%;
			/* The width is the width of the web page */
		}
	</style>

	<script async defer
		src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDHRCqL8yZbKNEZl7PFCmbA_XlaIBluHZ8&callback=initMap"></script>
	<!-- custom js -->
	<script src="../js/app.js"></script>
	<!-- Font Nunito from google -->
	<link
		href="https://fonts.googleapis.com/css2?family=Nunito:ital,wght@0,200;0,300;0,400;0,600;0,700;0,800;0,900;1,200;1,300;1,400;1,600;1,700;1,800;1,900&display=swap"
		rel="stylesheet" />

	<title>Alexandria | Properties</title>
</head>

<body>
	<!-- Beginning of NavBar -->
	<!-- Beginning of New NavBar Code -->

	<div class="container-fluid">
		<nav class="navbar-fixed nav-wrapper teal lighten-2">

			<a href="../../index.html" class=" brand-logo"><img id="alexandria-logo"
					src="../images/Alexandria-logo-BW.png" alt="Alexandria Logo" width="250"></a>
			<a href="#" data-target="mobile-links" class="sidenav-trigger"><i class="material-icons">menu</i></a>
			<ul class="right hide-on-med-and-down">
				<li class="active"><a class="btn" href="#">Properties</a></li>
				<li><a class="btn" href="#">Maps</a></li>
				<li><a class="btn" href="#">Dashboard</a></li>
				<li><a class="btn modal-trigger" href="#modal2">Contact Us</a></li>
			</ul>
		</nav>
		<ul class="sidenav" id="mobile-links">
			<li class="active"><a href="#">Properties</a></li>
			<li><a href="#">Maps</a></li>
			<li><a href="#">Dashboard</a></li>
			<li><a class="modal-trigger" href="#modal2">Contact Us</a></li>
		</ul>
	</div>

	<!-- End of New NavBar Code =====-->



	<!-- <div class="navbar-fixed fontSize">
		<nav class="teal lighten-2">
			<div class="nav-wrapper"> -->
	<!-- <a href="../../index.html" class="brand-logo"><img id="alexandria-logo" src="../images/Alexandria-logo-BW.png" width="200px" length="100px" ></a> -->
	<!-- <a href="../../index.html" data-target="mobile-demo" class="sidenav-trigger" ><i class="material-icons">menu</i></a > -->
	<!-- <ul class="left hide-on-med-and-down">
					<li>
						<a href="../../index.html"><img id="alexandria-logo" src="../images/Alexandria-logo-BW.png"
								width="250px" length="125px" /></a>
					</li>
					<li>
						<a class="dropdown-trigger" href="#" data-target="dropdown1">Properties<i
								class="material-icons right">arrow_drop_down</i></a>
					</li>
					<li><a href="#">Maps</a></li>
					<li><a href="#">Dashboard</a></li> -->
	<!-- Save for Later. DO NOT DELETE <li><a href="mobile.html">Mobile</a></li>-->
	<!-- </ul>
			</div> -->
	<!-- Dropdown Structure -->
	<!-- <ul id="dropdown1" class="dropdown-content">
				<li><a href="#!">one</a></li>
				<li><a href="#!">two</a></li>
				<li class="divider"></li>
				<li><a href="#!">three</a></li>
			</ul>
		</nav>
		<ul class="sidenav" id="mobile-demo">
			<li class="active"><a href="#">Properties</a></li>
			<li><a href="#">Maps</a></li>
			<li><a href="#">Dashboard</a></li> -->
	<!-- Save for Later. DO NOT DELETE <li><a href="mobile.html">Mobile</a></li>-->
	<!-- </ul>
		<div id="nav-image">
			<img src="../images/backgrounds/houses.jpg" width="100%" />

		</div>
	</div> -->
	<!-- End of NavBar -->

	<!-- Beginning of Heading -->
	<div class="container-fluid">

		<div class="row">


			<h5 id="property-header">PROPERTIES</h5>
			<!-- Beginning of Property listings. This Section will need to be dynamic with JS. -->
			<!-- Propertery #1 - Just a place holder-->
		</div>
	</div>
	<div class="property-body"></div>




	<!-- This section would populate address once user inputs information and it is stored in localStorage -->
	<!-- <div class="container-fluid">
		<div class="row">
			<div class="col">
				<h6>1790 WEST ARROW ROUTE, UPLAND, CA</h6>
			</div>
			<div class="col s3"> <span class="teal-text text-lighten-2">Rent</span>
				
			</div>

			<div class="col s3"> <span class="teal-text text-lighten-2">Expenses</span> </div>
			<div class="container-fluid">
				<div class="col pull-s4 s12 m12 l12"></div>
			<section class="property-buttons">
				<div class="col s3"> <a class="waves-effect waves-light btn-large"><i
							class="material-icons center">build</i></a> </div>
				<div class="col s3"> <a class="waves-effect waves-light btn-large"><i
							class="medium material-icons">monetization_on</i></a> </div>
			</section>
			</div>

		</div>
		</div>
	</div> -->

	<!-- add contact us modal -->
	<div id="modal2" class="modal modal-fixed-footer">
		<div class="modal-content">
			<h4>Contact Us</h4>
			<p>We'd love to hear from you, please drop us a message if you have any questions.</p>
			<div class="container">
				<form id="contactus">
					<label for="fullname">Full Name</label>
					<input type="text" id="fullname" />
					<br />
					<label for="customeremail"> Email </label>
					<input type="text" id="customeremail" />
					<br />
					<label for="message">Message</label>
					<input type="text" id="message" /></form>
			</div>
		</div>
		<div class="modal-footer">
			<a href="#!" class="modal-close waves-effect waves-green btn-flat">Send</a>
		</div>
	</div>

	<!-- add property modal -->
	<div id="addProperties" class="modal modal-fixed-footer">
		<div class="modal-content">
			<div class="row">

				<div class="col s12 main center">
					<h1>Add Properties</h1>
				</div>
			</div>


			<br />
			<div class="container">
				<form id="Property">
					<label for="streetAddress">Street Address</label>
					<input type="text" id="streetAddress" />
					<br />
					<label for="city"> City </label>
					<input type="text" id="city" required />
					<br />
					<label for="state">State abbreviation</label>
					<input type="text" id="state" maxlength="2" size="2" required />
					<br />
					<label for="zipcode">zip code</label>
					<input type="text" id="zipCode" maxlength="5" size="5" required />
					<br />
					<label for="expenses">Monthly Expenses</label>
					<input type="text" id="expenses" />
					<br />
					<label for="rent">Monthly Rent</label>
					<input type="text" id="rent" />
					<br />
					<div class="row">
						<a href="#!"><button class="col offset-s4 btn waves-effect waves-light modal-close"
								type="submit" id="addProperty"> Add Property</button></a>
					</div>
				</form>
			</div>
		</div>

	</div>
	<!-- property map modal -->
	<div id="propertyMap" class="modal modal-fixed-footer">
		<div class="modal-content">
			<div class="row">
				<div class="col s12 main center" id="mapTitle">

				</div>
			</div>


			<br />
			<div class="container">
				<div id="map"></div>

			</div>
		</div>


	</div>

	<!-- add property button -->
	<div class="row">

		<div class="col s12 center-align">
			<a class="waves-effect waves-light btn-large modal-trigger" href="#addProperties"><i
					class="medium material-icons">add</i></a>

		</div>
	</div>


	</div>






	<!-- script for add property modal -->
	<script>

		document.addEventListener('DOMContentLoaded', function () {
			var elems = document.querySelectorAll('.modal');
			var instances = M.Modal.init(elems);
		});
	</script>
	<!-- script for property map modal -->
	<script>

		document.addEventListener('DOMContentLoaded', function () {
			var elem = document.getElementById('#propertyMap');
			var instance = M.Modal.init(elem);
		});
	</script>
	<!-- script for dynamic content loading of property listings -->
	<script>
		// function to get properties from local storage object
		$(document).ready(function () {

			getFromLocal();
			getMash()


			// function to add properties to local storage

			var arr = [];

			// this event takes the inputs from the add property form fields, creates variables from them and passes them into the getLatLong function to return latitude and longitude fro google maps api
			$("#addProperty").on("click", function (event) {
				event.preventDefault();

				var addressVal = $("#streetAddress").val().trim().toUpperCase();
				var cityVal = $("#city").val().trim().toUpperCase();
				var stateVal = $("#state").val().trim().toUpperCase();
				var zipVal = $("#zipCode").val().trim().toUpperCase();
				var expensesVal = $("#expenses").val().trim().toUpperCase();
				var rentVal = $("#rent").val().trim().toUpperCase();
				// pushes address and info as an object into the arr array

				if (localStorage.getItem("addresses") != undefined) {
					arr = JSON.parse(localStorage.getItem("addresses"));
					arr.push({
						address: addressVal,
						city: cityVal,
						state: stateVal,
						zip: zipVal,
						expenses: expensesVal,
						rent: rentVal,
					});




				} else {
					arr.push({
						address: addressVal,
						city: cityVal,
						state: stateVal,
						zip: zipVal,
						expenses: expensesVal,
						rent: rentVal,
					});

				}
				// converts the arr array into json and stores it in local storage for use in the properties page
				localStorage.setItem("addresses", JSON.stringify(arr));
				location.reload(true);
				getFromLocal();
				getMash()

			});
			// 
			// function to get property objects from localStorage
			function getFromLocal() {

				// checks if addresses object in local storage exists
				if (localStorage.getItem("addresses") != undefined) {

					// if address object does exist this pulls the object and saves it as an array
					var addressArr = JSON.parse(localStorage.getItem("addresses"));


					// for loop runs through addressArr and dynamically builds out properties
					for (i = 0; i < addressArr.length; i++) {
						// builds out property div
						var propertyDivContainer = $("<div class='container-fluid'>")
						var propertyDiv = $("<div class='row'> ");
						var propertyDivStyle = $("<div class='col'>");
						var addressSpan = $("<span class='propAdd'>")
						var address = $("<h6 class='propAdd' id='address'>").text(
							addressArr[i].address.toUpperCase())
						var cityState = $("<h6 class='propAdd' id='city/state'>").text(
							" " +
							addressArr[i].city.toUpperCase() +
							" " +
							addressArr[i].state.toUpperCase() + " "
							+ addressArr[i].zip.toUpperCase()
						);
						addressSpan.append(address)
						addressSpan.append(cityState)
						// builds out rent display
						var rentDiv = $("<div class='col s3'>");
						var rentStyle = $("<span class='teal-text text-lighten-2'>");

						rentDiv.append(rentStyle);
						rentStyle.text("Monthly Rent: " + addressArr[i].rent);
						// builds out expense display
						var expenseDiv = $("<div class='col s3'>");
						var expenseStyle = $("<span class='teal-text text-lighten-2'>");

						expenseDiv.append(expenseStyle);
						expenseStyle.text("Monthly Expenses: " + addressArr[i].expenses);

						// builds out sqft display
						var sqftDiv = $("<div class='col s3'>");
						var sqftStyle = $("<span class='teal-text text-lighten-2'>")

						sqftDiv.append(sqftStyle).text("sqft: " + addressArr[i].sqFt)
						//  adds formatting for buttons
						var buttonDiv = $('<div class="container-fluid">')
						var buttonStyle = $('<div class="col pull-s4 s12 m12 l12"></div>')

						// builds out wrench icon
						var workIconDiv = $("<div class='col s3'>");
						var workLink = $("<a class='waves-effect waves-light btn-large'>");
						var workIcon = $("<i class='material-icons center'>");

						workIconDiv.append(workLink);
						workLink.append(workIcon);
						workIcon.text("build");
						// builds out money icon
						var moneyIconDiv = $("<div class='col s3'>");
						var moneyLink = $("<a class='waves-effect waves-light btn-large'>");
						var moneyIcon = $("<i class='material-icons center'>");

						moneyIconDiv.append(moneyLink);
						moneyLink.append(moneyIcon);
						moneyIcon.text("monetization_on");

						// builds out map icon
						var mapIconDiv = $("<div class='col s3'>");
						var mapLink = $("<a class='waves-effect waves-light btn-large modal-trigger' href='#propertyMap'>");
						var mapIcon = $("<i class='material-icons center'>");

						mapIconDiv.append(mapLink).on("click", function () {
							console.log($(this).parent().parent().siblings()[0].textContent)
							getLatLong($(this).parent().parent().siblings()[0].textContent)

							var mapTextH6 = $("<h6>")
							$("#mapTitle").html(mapTextH6)
							mapTextH6.text($(this).parent().parent().siblings()[0].textContent)


						})
						mapLink.html(mapIcon)
						mapIcon.text("map")
						// builds out delete icon

						var deleteIconDiv = $("<div class='col s3' id='delete'>");
						var deleteLink = $("<a class='waves-effect waves-light btn-large ' href=''>");

						var deleteIcon = $("<i class='material-icons center' >");
						deleteIcon.text("close")
						deleteLink.append(deleteIcon)
						deleteIconDiv.append(deleteLink)


						buttonSec = $('<section class="property-buttons">')
						// appends buttons to formatted div
						buttonSec.append(moneyIconDiv);
						buttonSec.append(workIconDiv);
						buttonSec.append(mapIconDiv)
						buttonSec.append(deleteIconDiv)

						buttonDiv.append(buttonStyle)
						buttonDiv.append(buttonSec)





						// appends property to body
						propertyDivStyle.append(addressSpan);
						propertyDiv.append(propertyDivStyle);
						propertyDiv.append(rentDiv);
						propertyDiv.append(expenseDiv);
						propertyDiv.append(sqftDiv)
						propertyDiv.append(buttonDiv)
						propertyDivContainer.append(propertyDiv)
						$(".property-body").append(propertyDivContainer);
					}
					// on click function to delete properties
					$(document).on("click", "#delete", function () {

						var results = [];
						// location of the address div
						var toSearch = $(this).parent().parent().siblings().find("#address")[0].textContent;
						// for loop that runs through the address array and checks for matching address to remove
						for (var i = 0; i < addressArr.length; i++) {
							// if statement that checks if the address matched the address value of any of the array objects
							if (addressArr[i].address.toUpperCase().indexOf(toSearch) != -1) {
								// if it is found this removes that object from the array
								addressArr.splice(i, 1)
								// once removed from the array this pushes the remaining array back into local storage
								localStorage.setItem("addresses", JSON.stringify(addressArr))

							}
						}


					})
				}

			}
			// this function takes in an address and hits the google geocode api, the api then returns a response in the form of a json object
			function getLatLong(a) {
				var queryURL =
					"https://maps.googleapis.com/maps/api/geocode/json?address=" +
					a +
					"&key=AIzaSyDHRCqL8yZbKNEZl7PFCmbA_XlaIBluHZ8";
				$.ajax({
					url: queryURL,
					method: "GET",
				}).then(function (response) {
					// this takes in the response from the geocode api traverses the object to get the latitude and longitude object
					var address = response.results[0].geometry.location;
					// the function then calls the init map function and passes in the latitude and longitude object
					initMap(address);


				});
			}
			// this function uses google's map api to build a map and place a  marker. it takes in an object containing the latitude and  longitude coordinates 
			// builds a map and places a marker at those coordinates
			function initMap(mark) {
				// The location of property
				var address = mark;
				// The map, centered at property address chosen
				var map = new google.maps.Map(document.getElementById("map"), {
					zoom: 13,
					center: address,
				});
				// The marker, positioned at the property address chosen
				var marker = new google.maps.Marker({ position: address, map: map });
			}
			function getMash() {
				if (localStorage.getItem("addresses") != undefined) {

					var array = JSON.parse(localStorage.getItem("addresses"))
					// console.log(array)
					for (i = 0; i < array.length; i++) {
						if (array[i].sqFt === undefined) {

							var address = array[i].address.replace(/ /gi, '%20')

							var city = array[i].city.replace(/ /gi, '%20');
							var state = array[i].state
							var zipCode = array[i].zip
							console.log(address)
							console.log(city)
							console.log(state)
							console.log(zipCode)
							var temp = null;
							console.log(temp);

							var settings = {
								"async": false,
								"crossDomain": true,
								"url": "https://mashvisor-api.p.rapidapi.com/property?zip_code=" + zipCode + "&address=" + address + "&city=" + city + "&state=" + state,
								"method": "GET",
								"headers": {
									"x-rapidapi-host": "mashvisor-api.p.rapidapi.com",
									"x-rapidapi-key": "733fad01b3msh9d3366df3709f73p1125dcjsn3fcf4af23a02"
								}
							}

							$.ajax(settings).done(function (response) {
								temp = response;

								array[i].sqFt = response.content.sqft
								console.log(array[i])
							});
							localStorage.setItem("addresses", JSON.stringify(array))
						}


					}

				}
			}



		})

	</script>
	<!-- <script src="../js/property.js"></script> -->




	<!--Footer -->
	<footer class="main page-footer teal lighten-2">
		<!-- Need to center it and add some padding through html or css -->
		© 2020 Alexandria. All rights reserved.
	</footer>


	<!-- JQuery -->
	<script src="https://code.jquery.com/jquery-2.2.4.min.js"
		integrity="sha256-BbhdlvQf/xTY9gja0Dq3HiwQF8LaCRTXxZKRutelT44=" crossorigin="anonymous"></script>
	<!-- <script src="https://code.jquery.com/jquery-3.5.1.js"
		integrity="sha256-QWo7LDvxbWT2tbbQ97B53yJnYU3WhH/C8ycbRAkjPDc=" crossorigin="anonymous"></script> -->

	<!-- Compiled and minified JavaScript -->
	<script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>
	<!-- <script src="../js/property.js"></script> -->
	<script>
		$(document).ready(function () {
			$('.sidenav').sidenav();
			$('.modal').modal();
		});
	</script>
</body>

</html>